## 📚 데이터베이스
##  ◆ 비관적 락, 낙관적 락
데이터베이스와 같은 다중 사용자 환경에서는 여러 트랜잭션이 동시에 같은 데이터에 접근하여 수정하려고 할 때 데이터 무결성
문제가 발생할 수 있다. 이러한 동시성 문제를 제어하기 위해 사용되는 대표적인 두 가지 방법이 바로 비관적 락과 낙관적 락이다.
이름에서 알 수 있듯이, 두 방식은 충돌 발생 가능성에 대해 상반된 관점을 가지고 접근한다.

---

## 📌 비관적 락(Pessimistic Lock)
비관적 락은 이름 그대로 "충돌이 발생할 것"이라고 비관적으로 가정하고 데이터에 접근하는 방식이다.
따라서 데이터에 접근하는 시점부터 트랜잭션이 끝날 때까지 다른 트랜잭션이 해당 데이터를 수정하지 못하도록 
미리 잠금(Lock)을 건다. 다른 트랜잭션은 잠금이 해제될 때까지 기다려야 한다.

### 작동방식:
1. 트랜잭션이 데이터를 읽거나 수정하기 위해 접근할 때, 해당 데이터에 잠금을 요청하고 획득한다.
2. 잠금을 획득한 트랜잭션이 작업을 진행하는 동안, 다른 트랜잭션은 해당 데이터에 접근할 수 없으며 대기 상태에 빠진다.
3. 작업이 완료되고 트랜잭션이 커밋(commit) 또는 롤백(rollback)되면 잠금을 해제한다.
4. 대기하던 다른 트랜잭션이 순차적으로 잠금을 획득하여 작업을 이어나간다.

### 장점:
- 강력한 데이터 무결성 보장: 데이터를 수정하는 동안 다른 트랜잭션의 접근을 원천적으로 차단하므로 데이터 충돌이 발생하지 않는다.
정합성이 매우 중요한 작업에 적합하다.
- 구현의 용이성: 개발자가 복잡한 충돌 처리 로직을 구현할 필요 없이, 데이터베이스가 제공하는 잠금 기능을 활용하면 된다.

### 단점:
- 성능 저하: 잠금을 획득하고 해제하는 과정에서 오버헤드가 발생하며, 특정 트랜잭션이 잠금을 오래 유지할 경우 다른 트랜잭션들의
대기 시간이 길어져 전체적인 시스템 성능이 저하될 수 있다.
- 교착 상태(Deadlock) 발생 가능성: 여러 트랜잭션이 서로 다른 리소스에 대해 잠금을 획득하고, 상대방의 잠금이 해제되기를 
기다리는 상황이 발생할 수 있다.

---

## 📌 낙관적 락 (Optimistic Lock)
낙관적 락은 "충돌이 거의 발생하지 않을 것"이라고 낙관적으로 가정하는 방식이다. 일단 데이터를 읽을 때는 잠금을 걸지 않고,
데이터를 수정하려는 시점에 다른 트랜잭션에 의해 데이터가 변경되었는지 확인한다. 만약 데이터가 변경되었다면, 충돌이 발생한 
것으로 간주하고 작업을 롤백하거나 재시도한다.

### 작동방식(버전 관리 기준):
1. 데이터를 읽을 때, 데이터의 버전(Version) 정보도 함께 읽어온다.
2. 트랜잭션이 작업을 수행하고 데이터를 수정하려 할 때, 자신이 읽었던 버전과 현재 데이터의 버전을 비교한다.
3. 버전이 동일하다면 다른 트랜잭션에 의한 변경이 없었다는 의미이므로, 데이터를 수정하고 버전 번호를 1 증가시킨 후 커밋한다.
4. 버전이 다르다면 다른 트랜잭션이 먼저 데이터를 수정했다는 의미이므로, 충돌이 발생한 것으로 판단하고 예외를 발생시키거나
작업을 롤백한다.

### 장점:
- 높은 동시성 및 성능: 데이터를 읽을 때 잠금을 사용하지 않으므로, 여러 트랜잭션이 동시에 데이터를 읽을 수 있다. 이로 인해 
비관적 락에 비해 성능이 좋다.
- 교착 상태(Deadlock) 미발생: 잠금을 걸고 기다리는 과정이 없으므로 교착 상태가 발생하지 않는다.

### 단점:
- 충돌 처리의 복잡성: 충돌이 발생했을 때 개발자가 직접 예외 처리, 데이터 롤백, 재시도 등의 로직을 구현해야 한다.
- 충돌이 잦을 경우 성능 저하: 충돌이 빈번하게 발생하면 롤백 및 재시도 비용이 커져 오히려 비관적 락보다 성능이 나빠질 수 있다.

---

## 📌 어떤 락을 선택해야할까?
비관적 락과 낙관적 락 중 어떤 것을 선택할지는 서비스의 특성과 데이터의 성격에 따라 결정해야 한다.
- 충돌이 자주 발생하고, 데이터의 정합성이 무엇보다 중요하다면 비관적 락이 적합하다.
- 읽기 작업이 압도적으로 많고, 가끔 발생하는 쓰기 충돌은 재시도 등으로 처리해도 되는 성능 중심의 서비스라면 낙관적 락이 
더 나은 선택이 될 수 있다.


 


