## 📚 스프링 카프카
##  ◆ enable.idempotence 설정
## 📌 enable.idempotence: true 설정값에 대해
### 정의:
enable.idempotence: true 설정은 ```Kafka 프로듀서```의 핵심 기능 중 하나로,
메시지 전송 시 정확히 한 번(Exactly-Once) 의미론을 달성하는 데 매우 중요한 역할을 한다.

#### 멱등성(Idempotence)이란?
수학이나 컴퓨터 과학에서 멱등성은 어떤 연산을 여러 번 수행하더라도 결과가 한 번 수행했을 때와
동일하게 유지되는 속성을 의미하는데, Kafka 프로듀서의 멱등성에서는 다음과 같은 의미를 가진다.
- ```프로듀서```가 메시지를 Kafka 브로커에 전송하는 과정에서 네트워크 오류, 브로커 장애 등으로 인해 메시지 전송이 실패하고 재시도될 수 있다.
- enable.idempotence: true 로 설정하면, 이러한 재시도에도 불구하고 동일한 메시지가 Kafka 토픽의 파티션에 단 한 번만 기록되도록 보장한다.

### 어떻게 동작하는가:
Kafka 는 멱등성 프로듀서를 위해 내부적으로 다음 메커니즘을 사용한다.
- 프로듀서 ID: 각 멱등성 프로듀서에게 고유한 ID가 할당된다.
- 시퀀스 번호: 각 메시지에는 PID 와 함께 증가하는 시퀀스 번호가 부여된다.
- 브로커의 중복 감지: Kafka 브로커는 각 PID 와 시퀀스 번호 쌍을 추적한다. 프로듀서가 메시지를 재전송하더라도,
브로커는 이미 해당 PID 와 시퀀스 번호를 가진 메시지를 받았는지 확인하여 중복된 메시지는 무시하고 한 번만 기록하게된다.

### 고려사항:
- acks 및 retries와의 관계: enable.idempotence=true로 설정하면, 내부적으로 acks는 자동으로 all로 설정되고, retries는 
Integer.MAX_VALUE로 설정된다. 이는 멱등성 보장을 위해 필요한 설정이므로, 명시적으로 다른 값으로 설정하더라도 무시되거나 오류가 발생할 수 있다.
- 이렇게 설정되는 이유는 멱등성이 "정확히 한 번" 전송을 보장하기 위해 메시지가 모든 동기화된 복제본에 기록될 때까지 기다리고(acks: all),
필요할 경우 무한히 재시도해야 하기 때문이다.

결론적으로, enable.idempotence: true는 Kafka를 사용하는 애플리케이션에서 메시지 전송의 신뢰성을 크게 향상시키고,
데이터 무결성을 보장하는 데 필수적인 설정이라고 할 수 있다.






